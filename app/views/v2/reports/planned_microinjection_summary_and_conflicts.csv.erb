Planned Micro-Injection Summary and Conflicts

# Genes in Planned Micro-Injection Statuses

Consortium, <%= @statuses.map {|status| status.name}.join(', ') %>, TOTAL BY CONSORTIUM
<% for consortium in @consortia %>
<%= consortium %>, <%= @statuses.map {|status| @consortia_by_status["#{consortium} - #{status.name}"] || 0 }.join(', ') %>, <%= @consortia_totals[consortium] || 0 %>
<% end %>
TOTAL BY STATUS, <%= @statuses.map {|status| @status_totals[status.name] || 0}.join(', ') %>, <%= @gene_count %>

# Genes in Priority Groups

Consortium, <%= @priorities.map {|priority| priority.name}.join(', ') %>, TOTAL BY CONSORTIUM
<% for consortium in @consortia %>
<%= consortium %>, <%= @priorities.map {|priority| @consortia_by_priority["#{consortium} - #{priority.name}"] || 0}.join(', ') %>, <%= @consortia_totals[consortium] || 0 %>
TOTAL BY PRIORITY, <%= @priorities.map {|priority| @priority_totals[priority.name] || 0 }.join(', ') %>, <%= @gene_count %>
<% end %>

# Genes in Planned Micro-Injections by Status / Priority

<% for status in @statuses %>
  <% next if @consortia.map {|c| @priorities.map{|p| @consortia_by_priority["#{c} - #{p.name} - #{status.name}"].to_i || 0}}.flatten.sum == 0 %>

  <%= status.name %>

  Consortium, <%= @priorities.map {|priority| priority.name}.join(', ') %>
  <% for consortium in @consortia %>
    <% next if @priorities.map{|p| @consortia_by_priority["#{consortium} - #{p.name} - #{status.name}"].to_i || 0}.sum == 0 %>
    <%= consortium %>, <%= @priorities.map {|priority| @consortia_by_priority["#{consortium} - #{priority.name} - #{status.name}"] || 0 }.join(', ') %>
  <% end %>
<% end %>

Conflicting Micro-Injection Plans

<% if @conflicting_mi_plans.size == 0 %>
  No conflicts to report
<% else %>
  Consortium, SubProject, Bespoke, Production Centre, Marker Symbol, MGI Accession ID, Priority, Reason for conflict
  <% for mi_plan in @conflicting_mi_plans %>
    <%= mi_plan.consortium.name %>, <%= mi_plan.sub_project.name if mi_plan.sub_project %>, <%= mi_plan.is_bespoke_allele ? 'Yes' : 'No' %>, <%= mi_plan.production_centre.name if mi_plan.production_centre %>, <%= mi_plan.marker_symbol %>, <%= mi_plan.mgi_accession_id %>, <%= mi_plan.priority.name if mi_plan.priority %>, <%= conflict_text(mi_plan, @conflicting_mi_plans) %>
  <% end %>
<% end %>

Inspect Micro-Injection Plans

<% for status in @mi_plans.group_by {|m| m.status.name} %>

<%= status.first %>

Consortium, SubProject, Bespoke, Production Centre, Marker Symbol, MGI Accession ID, Priority, Reason for conflict
<% for mi_plan in status.last %>
<%= mi_plan.consortium.name %>, <%= mi_plan.sub_project.name if mi_plan.sub_project %>, <%= mi_plan.is_bespoke_allele ? 'Yes' : 'No' %>, <%= mi_plan.production_centre.name if mi_plan.production_centre %>, <%= mi_plan.marker_symbol %>, <%= mi_plan.mgi_accession_id %>, <%= mi_plan.priority.name if mi_plan.priority %>, <%= reason_for_inspect_or_conflict(mi_plan, @mi_plans).gsub(/'/, '') %>
<% end %>
<% end %>