<% generator = FieldGenerator.new(form) %>
<% phenotype_attempt = form.object %>

<fieldset class="collapsible">
  <legend>Universal Details</legend>
  <div>
    <% if @mi_attempt %>
      <label>MI Attempt Colony Name</label>
      <%= @mi_attempt.colony_name %>
      <%= form.hidden_field 'mi_attempt_colony_name', :value => @mi_attempt.colony_name %>
    <% end %>
  </div>
  <div>
    <%= generator.text_field(:colony_name, :class => 'x-form-text', :size => 20) %>
  </div>
  <div>
    <% if ! @phenotype_attempt.status_id.nil? %>
      <label>Status</label>
      <%= @phenotype_attempt.status_name%>
      <%= form.hidden_field 'phenotype_attempt_status_name', :value => @phenotype_attempt.status_name || 'p' %>
    <% end %>
  </div>
  <div>
    <%= form.label :is_active, :is_active.to_s.titlecase %>
    <%= form.check_box :is_active %>
  </div>
</fieldset>

<fieldset class="collapsible" id="distribution_centres">
  <legend>Distribution Centres</legend>
  <div class="distribution_centres">
    <% if ['cec', 'pds', 'pdc'].include?(phenotype_attempt.status.try(:code)) %>
      <table id="distribution_centres_table" class="report_table">
        <thead class="title">
          <tr>
            <th>Distribution centre</th>
            <th>Distribution network?</th>
            <th>Deposited material</th>
            <th>Start date</th>
            <th>End date</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody class="distribution_centres">
        <tr></tr>
          <% if phenotype_attempt.distribution_centres.length > 0 %>
            <%= form.fields_for :distribution_centres do |builder| %>
              <% if !builder.object.new_record? %>
                <%= render '/shared/distribution_centre_fields', f: builder %>
              <% end %>
            <% end %>
          <% end %>
        </tbody>
      </table>
      <% if @phenotype_attempt.has_status? :cec %>
        <%= link_to_add_fields "Add Distribution Centre", form, :distribution_centres %>
      <% end %>
    <% else %>
      No Distribution Centres can be set until Status is Cre Excision Complete.
    <% end %>
  </div>
</fieldset>

<fieldset class="collapsible">
  <legend>Rederivation</legend>
  <% [:rederivation_started, :rederivation_complete].each do |field| %>
    <div>
      <%= form.label field, field.to_s.titlecase %>
      <%= form.check_box field %>
    </div>
  <% end %>
</fieldset>
<fieldset class="collapsible">
  <legend>Cre Excision</legend>

  <div>
    <div>
      <%= form.label :cre_excision_required, 'Is Cre-Excision Required?' %>
      <%= form.check_box :cre_excision_required %>
    </div>
    <div>
      <%= generator.text_field :phenotyping_experiments_started, :label => 'Phenotyping Experiments Started', :class => 'date-field' %>
    </div>
    <div id="cre-excision-fields" class="<%= @phenotype_attempt.cre_excision_required ? '' : 'hidden' %>">
      <div>
        <%= form.label :tat_cre, "Cre Excision via TAT-Cre?" %>
        <%= form.check_box :tat_cre %>
      </div>
      <div id="tat-cre-hidden-fields" class="<%= @phenotype_attempt.tat_cre ? 'hidden' : '' %>">
        <div>
          <%= form.label :deleter_strain_name, 'Cre-deleter Strain' %>
        </div>
        <div>
          <%= form.collection_select :deleter_strain_name, @deleter_strain,:name, :name, :include_blank => true %>
        </div>
        <div>
          <%= generator.number_field :number_of_cre_matings_successful %>
        </div>
      </div>
      <div>
        <%= generator.mouse_allele_type_field %>
      </div>
    </div>
    <div>
     <%= form.label :colony_background_strain_name, 'Colony Background Strain' %>
    </div>
    <div>
      <%= form.collection_select :colony_background_strain_name, Strain.all, :name, :pretty_drop_down, :include_blank => true %>
    </div>
  </div>
</fieldset>
<fieldset class="collapsible">
  <legend>Other</legend>

  <% [:report_to_public, :is_active].each do |field| %>
    <div>
      <%= form.label field, field.to_s.titlecase %>
      <%= form.check_box field %>
    </div>
  <% end %>
</fieldset>
